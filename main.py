# app.py (오류 수정 완료)
import streamlit as st
from datetime import datetime
import json

# -----------------------------
# Page Config
# -----------------------------
st.set_page_config(page_title="MBTI 진로 추천", layout="wide")

# -----------------------------
# MBTI 소개 데이터
# -----------------------------
MBTI_INTRO = {
    "INTJ": "전략적이고 독립적인 사색가 🧠",
    "INTP": "논리적 탐구자 🔍",
    "ENTJ": "비전 있는 리더 🚀",
    "ENTP": "아이디어 스파크 창업가 💡",
    "INFJ": "통찰력 있는 상담자 🌿",
    "INFP": "가치 중심의 스토리텔러 ✍️",
    "ENFJ": "사람을 이끄는 조력자 🤝",
    "ENFP": "영감 주는 탐험가 🌈",
    "ISTJ": "신뢰받는 관리자 📘",
    "ISFJ": "세심한 돌봄 제공자 🧺",
    "ESTJ": "체계적인 운영가 🧭",
    "ESFJ": "따뜻한 커뮤니티 빌더 🫶",
    "ISTP": "문제 해결 장인 🛠️",
    "ISFP": "감성적인 크리에이터 🎨",
    "ESTP": "액션 중심의 실행가 ⚡",
    "ESFP": "무대 위의 엔터테이너 🎤",
}

# -----------------------------
# MBTI별 추천 직업 예시 (최소 3개씩)
# -----------------------------
CAREERS = {
    "INTJ":[
        {"job":"전략 컨설턴트","why":"논리와 전략적 사고 활용","skills":["분석","기획"],"learn":["경영","데이터 분석"]},
        {"job":"연구원","why":"깊이 있는 문제 해결","skills":["조사","논리적 사고"],"learn":["실험 설계","리서치"]},
        {"job":"프로젝트 매니저","why":"효율적인 계획 수립","skills":["조직력","리더십"],"learn":["PM 방법론","리스크 관리"]},
    ],
    "INTP":[
        {"job":"소프트웨어 개발자","why":"논리적 구조 설계","skills":["코딩","알고리즘"],"learn":["자료구조","시스템 설계"]},
        {"job":"데이터 분석가","why":"데이터에서 인사이트 도출","skills":["분석","통계"],"learn":["Python","SQL"]},
        {"job":"연구원","why":"이론적 탐구와 실험","skills":["논문 조사","문제 해결"],"learn":["실험 설계","모델링"]},
    ],
    "ENTJ":[
        {"job":"기업 CEO","why":"비전과 리더십 발휘","skills":["전략","조직관리"],"learn":["재무","리더십"]},
        {"job":"프로젝트 매니저","why":"체계적 관리와 실행","skills":["조직력","계획"],"learn":["PMO","리스크 관리"]},
        {"job":"전략 컨설턴트","why":"문제 해결 능력 활용","skills":["분석","전략"],"learn":["비즈니스 전략","문제 정의"]},
    ],
    "ENTP":[
        {"job":"스타트업 창업가","why":"창의적 아이디어 실행","skills":["아이디어 발굴","커뮤니케이션"],"learn":["투자","제품 개발"]},
        {"job":"마케팅 기획자","why":"창의적 캠페인 설계","skills":["분석","아이디어"],"learn":["광고 전략","시장 조사"]},
        {"job":"컨설턴트","why":"문제 해결과 창의력 활용","skills":["분석","발상 전환"],"learn":["문제 정의","솔루션 설계"]},
    ],
    "INFJ":[
        {"job":"심리 상담사","why":"타인의 감정 이해","skills":["공감","상담"],"learn":["심리학","코칭"]},
        {"job":"작가","why":"깊이 있는 메시지 전달","skills":["글쓰기","스토리텔링"],"learn":["창작","논리 전개"]},
        {"job":"NGO 활동가","why":"가치 중심 사회 공헌","skills":["조직","커뮤니케이션"],"learn":["사회문제 연구","프로젝트 관리"]},
    ],
    "INFP":[
        {"job":"작가","why":"가치 중심 창작 활동","skills":["글쓰기","상상력"],"learn":["스토리텔링","문화 연구"]},
        {"job":"아티스트","why":"감성 표현","skills":["그림","음악"],"learn":["예술 기법","창작 과정"]},
        {"job":"상담사","why":"타인의 내적 성장 지원","skills":["공감","대화"],"learn":["심리학","코칭"]},
    ],
    "ENFJ":[
        {"job":"HR 매니저","why":"팀 성장과 관리","skills":["리더십","조정"],"learn":["인사 관리","조직 심리"]},
        {"job":"교사","why":"학생 동기 부여","skills":["커뮤니케이션","조직"],"learn":["교육학","수업 설계"]},
        {"job":"코치/멘토","why":"개인 성장 지원","skills":["코칭","상담"],"learn":["심리학","멘토링"]},
    ],
    "ENFP":[
        {"job":"마케터","why":"창의적 캠페인","skills":["아이디어","소통"],"learn":["광고 전략","콘텐츠 제작"]},
        {"job":"기자","why":"호기심 탐험과 전달","skills":["글쓰기","조사"],"learn":["인터뷰","취재"]},
        {"job":"창업가","why":"새로운 시도와 실험","skills":["리더십","문제 해결"],"learn":["제품 개발","비즈니스 전략"]},
    ],
    "ISTJ":[
        {"job":"회계사","why":"정확성과 체계성 활용","skills":["수리","기록"],"learn":["회계 원리","재무 관리"]},
        {"job":"관리자","why":"조직 운영과 규칙 준수","skills":["계획","관리"],"learn":["PMO","행정 업무"]},
        {"job":"엔지니어","why":"정확한 시스템 운영","skills":["분석","문제 해결"],"learn":["설계","품질 관리"]},
    ],
    "ISFJ":[
        {"job":"간호사","why":"세심한 돌봄 제공","skills":["관찰","응급 대처"],"learn":["간호학","심리학"]},
        {"job":"교사","why":"학생 관리와 지원","skills":["조직","소통"],"learn":["교육학","수업 설계"]},
        {"job":"사서","why":"정보 관리 및 지원","skills":["정리","분류"],"learn":["정보학","자료 조사"]},
    ],
    "ESTJ":[
        {"job":"운영 관리자","why":"조직과 규율 관리","skills":["계획","리더십"],"learn":["운영 전략","팀 관리"]},
        {"job":"군인","why":"체계적 명령 수행","skills":["조직력","결정"],"learn":["전략","훈련"]},
        {"job":"프로젝트 매니저","why":"효율적 프로젝트 운영","skills":["조직","리스크 관리"],"learn":["PM 기법","문제 해결"]},
    ],
    "ESFJ":[
        {"job":"이벤트 플래너","why":"사람 중심 조직","skills":["커뮤니케이션","조정"],"learn":["기획","운영"]},
        {"job":"간호사","why":"돌봄과 지원","skills":["관찰","소통"],"learn":["간호학","심리학"]},
        {"job":"교사","why":"학생과 학부모 관리","skills":["조직","공감"],"learn":["교육학","수업 설계"]},
    ],
    "ISTP":[
        {"job":"기계 엔지니어","why":"문제 해결 능력 발휘","skills":["분석","수리"],"learn":["CAD","제작 기법"]},
        {"job":"파일럿","why":"실제 경험과 판단력 필요","skills":["조종","판단"],"learn":["비행술","안전 관리"]},
        {"job":"프로그래머","why":"논리적 문제 해결","skills":["코딩","디버깅"],"learn":["자료구조","알고리즘"]},
    ],
    "ISFP":[
        {"job":"디자이너","why":"감성적 창작","skills":["드로잉","색감"],"learn":["그래픽 디자인","포토샵"]},
        {"job":"뮤지션","why":"감정 표현","skills":["악기 연주","작곡"],"learn":["음악 이론","녹음"]},
        {"job":"사진작가","why":"순간 포착","skills":["사진 촬영","편집"],"learn":["조명","후보정"]},
    ],
    "ESTP":[
        {"job":"영업 전문가","why":"즉각적 대응과 설득","skills":["커뮤니케이션","판단"],"learn":["영업 전략","협상"]},
        {"job":"응급 구조사","why":"빠른 판단과 행동","skills":["응급처치","협력"],"learn":["응급 대응","안전 관리"]},
        {"job":"운동 선수","why":"실력과 집중력 발휘","skills":["체력","전략"],"learn":["훈련","전략 게임"]},
    ],
    "ESFP":[
        {"job":"배우","why":"공연과 감정 표현","skills":["연기","표현력"],"learn":["연기 기법","무대 경험"]},
        {"job":"가수","why":"음악과 무대 활동","skills":["노래","퍼포먼스"],"learn":["보컬","댄스"]},
        {"job":"이벤트 호스트","why":"현장 운영과 진행","skills":["소통","조정"],"learn":["이벤트 기획","대인 관계"]},
    ],
}

# -----------------------------
# MBTI 선택
# -----------------------------
st.title("🌈 MBTI 진로 추천")
user_mbti = st.selectbox("당신의 MBTI를 선택하세요:", list(MBTI_INTRO.keys()))

# -----------------------------
# 추천 직업 표시
# -----------------------------
st.subheader(f"{user_mbti} — {MBTI_INTRO[user_mbti]}")
for job in CAREERS[user_mbti]:
    st.markdown(f"**{job['job']}** — {job['why']}")
    st.markdown(f"- 🔧 필수 역량: {', '.join(job['skills'])}")
    st.markdown(f"- 📚 추천 학습: {', '.join(job['learn'])}")
    st.markdown("---")

# -----------------------------
# JSON 다운로드
# -----------------------------
payload = json.dumps({
    "mbti": user_mbti,
    "intro": MBTI_INTRO[user_mbti],
    "careers": CAREERS[user_mbti],
}, ensure_ascii=False, indent=2)

st.download_button("📥 JSON 다운로드", file_name=f"{user_mbti}_careers.json", mime="application/json")
